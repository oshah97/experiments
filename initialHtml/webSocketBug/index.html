<!DOCTYPE html>
<html>
<head>
<title>~/s/examples/R/websockets/httpuv/daemonEcho1</title>
<style type="text/css">
body { font-family: Helvetica; }
pre { margin: 0 }
</style>

<script>
  var socketURI = window.location.href.replace("http://", "ws://");
  var ws = new WebSocket(socketURI);
  ws.onmessage = function(msg) {
     var msgDiv = document.getElementById("outputDiv");
     var incomingMessage = JSON.parse(msg.data);
     console.log("incoming message: "); 
     console.log(incomingMessage);
     var cmd = incomingMessage.cmd;
     var payload = incomingMessage.payload;
     console.log("msg.data");
     console.log(msg.data);
     var outgoingText;
     var callback = incomingMessage.callback;
     var status = "success"  // be optimistic
     if(cmd == "toUpperCase"){
         outgoingText = payload.toUpperCase()
         }
      else if (cmd == "toLowerCase"){
         outgoingText = payload.toLowerCase()
         }
      else{
	 outgoingText = "unrecognized command '" + cmd + "'";
         status = "failure";
         }
     msgDiv.innerHTML = "<b>received:</b> " + payload + "<br><b>returning: </b> " + outgoingText;
      returnMessage = JSON.stringify( {cmd: callback,
				      status: status,
				      payload: outgoingText
 				     });

     console.log(returnMessage);
     ws.send(returnMessage);
  
     }

  function sendInput() {
     var input = document.getElementById('input');
     ws.send(input.value);
     input.value = '';
     }
</script>

</head>

<body>
<h4> Simple httpuv daemonized web socket server test</h4>
<h5> Strings received from R (<i> send(wsCon, "demo")</i> are returned in upper case</h5>
<button>
<div id="outputDiv"></div>
</body>

</html>
